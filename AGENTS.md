# Инструкции для агентов — News Aggregator

## Цель
Единый регламент для всех AI-агентов в проекте.  
Если пользователь даёт короткий запрос без деталей (например: «исправь ревью», «переходим к следующему этапу», «подправь баг») — действовать по этому документу.

## О проекте
Интеллектуальный агрегатор технологических новостей (программирование, AI, ОС).  
Стек: `SvelteKit 5 (Runes)` + `TypeScript` + `TailwindCSS` + `PostgreSQL/Drizzle`.  
Язык интерфейса: русский (`lang="ru"`).

## Обязательный контекст — читать перед любой задачей
Перед началом работы всегда прочитай файлы в порядке:

1. `AI_MEMORY.md` — текущий этап, прогресс, последние решения
2. `ROADMAP.md` — план развития (Stage 5-12)
3. `ARCHITECTURE.md` — актуальная архитектура и стек
4. `MINOR_ISSUES.md` — backlog мелких задач и техдолга
5. Последний файл в `ai_code_reviews/` — актуальные замечания

Не начинай писать код, пока не прочитал `AI_MEMORY.md` и `ROADMAP.md`.

Не читать: `docs/archive/*` — устаревшие документы.

## Ключевые правила
- Всегда отвечать на русском языке.
- Код и имена сущностей на английском; UI-тексты и документация на русском.
- `TypeScript strict`: никаких `any`.
- Для объектов данных использовать `interface`.
- В `Svelte 5` использовать Runes (`$props`, `$state`, `$derived`, `$effect`), не использовать stores.
- Не откатывать чужие изменения без явной команды.
- Не использовать destructive git-команды.

## Режимы работы

### 1) Режим «Исправь ревью»
1. Прочитать последний файл в `ai_code_reviews/`.
2. Проверить связанные пункты в `MINOR_ISSUES.md`.
3. Разобрать приоритеты: `P0 -> P1 -> P2`.
4. Критически оценить замечания (ревьюер может ошибаться).
5. Исправить код, прогнать проверки, вернуть отчёт.
6. Если пункт уже неактуален, явно отметить это в `MINOR_ISSUES.md` с коротким объяснением.

### 2) Режим «Переходим к следующему этапу»
1. Определить текущий Stage по `AI_MEMORY.md`.
2. Найти следующий Stage в `ROADMAP.md`.
3. Реализовать задачи по приоритету `P0 -> P1 -> P2`.
4. Прогнать обязательные проверки.
5. Обновить статусы в `ROADMAP.md` и `AI_MEMORY.md`.

### 3) Режим «Что-то поправить» (без деталей)
1. Проверить последний review и `MINOR_ISSUES.md`.
2. Исправить самый критичный риск.
3. Запросить уточнение только если есть несколько равнозначных направлений.

## Технический чеклист (обязательный)
- Безопасность: sanitize HTML, decode entities, таймауты внешних запросов (8s RSS), `noopener noreferrer`, CSP.
- Производительность: кеширование и отсутствие блокирующих внешних запросов.
- SEO: корректные `title/description`, OpenGraph, JSON-LD, `sitemap.xml`, `robots.txt`.
- A11y: `lang="ru"`, семантическая разметка, корректная клавиатурная навигация.
- SvelteKit/Svelte 5: server-side `load`, `setHeaders`, Runes API, строгая типизация.

## Стиль кода
- Отступы: 2 пробела.
- Кавычки: одинарные.
- Точки с запятой: обязательны.
- Длина строки: около 100 символов.
- Импорты: внешние -> `$lib` -> относительные.
- Именование:
  - Компоненты: `PascalCase.svelte`
  - Интерфейсы: `PascalCase`
  - Функции/переменные: `camelCase`
  - Константы: `UPPER_SNAKE`
  - Файлы: `kebab-case.ts`

## Команды
```bash
npm install
npm run dev
npm run build
npm run preview
```

## Проверка и тесты
```bash
npm run check
npm run check:watch
npm run test
npm run test:run
```

Тесты: `src/**/*.test.ts` (Vitest, `node` environment).

Обязательно после изменений:
```bash
npm run check && npm run build && npm run test:run
```

## Формат коммитов
- `feat:` — новая функциональность
- `fix:` — исправление бага/замечаний ревью
- `refactor:` — рефакторинг без изменения поведения
- `test:` — тесты
- `chore:` — конфигурация/инфраструктура

## Формат финального отчёта агента
1. Что сделано (кратко)
2. Какие файлы изменены
3. Результат проверок (`check/build/test`)
4. Что осталось и почему (если есть)

---

**Обновлено:** 16.02.2026
