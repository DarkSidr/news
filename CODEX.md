# Инструкции для Codex — News Aggregator

## Цель
Файл нужен для быстрого входа в контекст без повторных объяснений от пользователя.
Если пользователь пишет коротко (например: «почини ревью», «переходим к Stage 2», «подправь баги») — действовать по этому документу.

## Источники истины (читать в таком порядке)
1. `AI_MEMORY.md` — текущий статус, этап, последние решения.
2. `TECHNICAL_PLAN.md` — целевая архитектура и требования.
3. Последний файл ревью в `ai_code_reviews/*.md`.

## Краткий контекст проекта
- Продукт: интеллектуальный агрегатор техновостей (программирование, AI, ОС).
- Стек: `SvelteKit 5`, `Svelte 5 Runes`, `TypeScript`, `TailwindCSS`.
- Язык интерфейса: русский (`lang="ru"`, тексты UI на русском).
- Базовые требования: безопасность, SEO, a11y, PWA, производительность, готовность к масштабированию.

## Режимы задач

### 1) Пользователь дал файл ревью и просит исправить
Алгоритм:
1. Прочитать ревью и выписать задачи по приоритету: `P0 -> P1 -> P2`.
2. Подвергнуть замечания реальному анализу возможно твой ревьюр ошибается
3. Сопоставить каждое замечание с конкретным файлом/строкой.
4. Исправлять сразу в коде (не ограничиваться планом).
5. После фиксов прогнать проверки.
6. Вернуть отчёт: что исправлено, что не исправлено, почему.

### 2) Пользователь пишет «переходим к следующему этапу»
Алгоритм:
1. Определить текущий этап из `AI_MEMORY.md`.
2. Взять следующий этап из `TECHNICAL_PLAN.md`.
3. Реализовать минимальный рабочий срез этапа (MVP этапа).
4. Прогнать проверки.
5. Обновить `AI_MEMORY.md` краткой записью о выполненном.

### 3) Пользователь пишет «что-то поправить» без деталей
Алгоритм:
1. Проверить последние изменения и последний review-файл.
2. Найти открытые замечания/риски.
3. Исправить самое критичное сначала.
4. Попросить уточнение только если есть несколько равнозначных направлений.

## Технический чеклист фиксов (обязательный)
- Безопасность:
  - Санитизация внешнего контента (RSS/API).
  - Таймауты и обработка ошибок сетевых запросов.
  - Безопасные внешние ссылки (`noopener noreferrer`).
- Производительность:
  - Кеш-заголовки (`cache-control`) где уместно.
  - Без лишних блокирующих запросов.
- SEO:
  - `title`, `description`, `robots`, OpenGraph.
  - При необходимости JSON-LD (`WebSite`, `ItemList`, `NewsArticle`).
- A11y:
  - `lang="ru"`, skip-link, корректная семантика.
  - Не дублировать одинаковые интерактивные ссылки в карточке.
- PWA:
  - `manifest.webmanifest`.
  - `service-worker` + регистрация.
- SvelteKit best practices:
  - Server-side `load`/`setHeaders` в корректных местах.
  - Типизация без `any`.

## Команды проверки перед ответом пользователю
```bash
npm run check
npm run build
```
Если есть тесты, дополнительно:
```bash
npm run test
```

## Формат финального ответа пользователю
1. Кратко: результат (что сделано).
2. Список исправлений по файлам.
3. Статус проверок (`check/build/test`).
4. Что осталось (если осталось) и почему.
5. Сделать коммит и запушить в названии коммита использовать название файла ревью из папки `ai_code_reviews`.

## Ограничения
- Не откатывать чужие изменения без явной команды пользователя.
- Не использовать destructive git-команды.
- Если найден неожиданный конфликтующий diff — остановиться и спросить пользователя.
- Всегда отвечать на русском в этом проекте.
