# Инструкции для Codex — News Aggregator

## Цель
Файл нужен для быстрого входа в контекст без повторных объяснений от пользователя.
Если пользователь пишет коротко (например: «почини ревью», «переходим к Stage 5», «подправь баги») — действовать по этому документу.

## Обязательный контекст — читать перед любой задачей
Перед началом работы **всегда** прочитай эти файлы (в указанном порядке):

1. `AI_MEMORY.md` — текущий статус, этап, последние решения
2. `ROADMAP.md` — план развития (Stage 5-12) с конкретными задачами
3. `ARCHITECTURE.md` — текущий стек и архитектура
4. Последний файл ревью в `ai_code_reviews/*.md`
5. `MINOR_ISSUES.md` — backlog мелких рекомендаций

**Не начинай писать код, пока не прочитал `AI_MEMORY.md` и `ROADMAP.md`.**

**Не читать:** `docs/archive/*` — устаревшие документы

## Краткий контекст проекта
- Продукт: интеллектуальный агрегатор техновостей (программирование, AI, ОС)
- Стек: `SvelteKit 5`, `Svelte 5 Runes`, `TypeScript`, `TailwindCSS`, `PostgreSQL + Drizzle`
- Язык интерфейса: русский (`lang="ru"`, тексты UI на русском)
- Базовые требования: безопасность, SEO, a11y, PWA, производительность

## Режимы задач

### 1) Пользователь дал файл ревью и просит исправить
1. Прочитать ревью и выписать задачи по приоритету: `P0 → P1 → P2`
2. Критически оценить замечания — ревьюер мог ошибаться
3. Сопоставить каждое замечание с конкретным файлом/строкой
4. Исправлять сразу в коде (не ограничиваться планом)
5. После фиксов прогнать проверки
6. Вернуть отчёт: что исправлено, что нет, почему

### 2) Пользователь пишет «переходим к следующему этапу»
1. Определить текущий этап из `AI_MEMORY.md`
2. Открыть `ROADMAP.md` → найти следующий Stage
3. Выполнять задачи по приоритету P0 → P1 → P2
4. Прогнать проверки
5. Отметить `[x]` в `ROADMAP.md`, обновить `AI_MEMORY.md`

### 3) Пользователь пишет «что-то поправить» без деталей
1. Проверить последние изменения и последний review-файл
2. Найти открытые замечания/риски
3. Исправить самое критичное сначала
4. Попросить уточнение только если есть несколько равнозначных направлений

## Технический чеклист (обязательный)
- **Безопасность:** санитизация внешнего контента, таймауты fetch, `noopener noreferrer`
- **Производительность:** cache-control, без блокирующих запросов
- **SEO:** title, description, robots, OpenGraph, JSON-LD (WebSite, ItemList)
- **A11y:** `lang="ru"`, skip-link, семантика, нет дублей интерактивных ссылок
- **PWA:** manifest.webmanifest, service-worker + регистрация
- **SvelteKit:** server-side load/setHeaders, Svelte 5 Runes ($state/$derived/$effect), типизация без `any`

## Команды проверки
```bash
npm run check && npm run build && npm run test:run
```

## Формат коммитов
- `feat:` — новая функциональность
- `fix:` — исправление бага / замечаний ревью
- `refactor:` — рефакторинг
- `test:` — тесты
- `chore:` — конфигурация

Для фиксов ревью: `fix: <описание>` + ссылка на файл ревью в теле коммита.

## Формат финального ответа
1. Кратко: результат (что сделано)
2. Список исправлений по файлам
3. Статус проверок (check/build/test)
4. Что осталось (если осталось) и почему
5. Коммит с понятным сообщением

## Ограничения
- Не откатывать чужие изменения без явной команды
- Не использовать destructive git-команды
- Если найден конфликтующий diff — остановиться и спросить
- Всегда отвечать на русском

---

**Обновлено:** 16.02.2026 (после Stage 7 Overhaul)
